import requests
import string


def get_aqi_by_location(api, city, state):
    wind_direction_dict = {
        1: 'N',
        2: 'N',
        3: 'N',
        4: 'N',
        5: 'N',
        6: 'N',
        7: 'N',
        8: 'N',
        9: 'N',
        10: 'N',
        360: 'N',
        359: 'N',
        358: 'N',
        357: 'N',
        356: 'N',
        355: 'N',
        354: 'N',
        353: 'N',
        352: 'N',
        351: 'N',
        350: 'N',
        20: 'N/NE',
        21: 'N/NE',
        22: 'N/NE',
        23: 'N/NE',
        24: 'N/NE',
        25: 'N/NE',
        26: 'N/NE',
        27: 'N/NE',
        28: 'N/NE',
        29: 'N/NE',
        30: 'N/NE',
        31: 'N/NE',
        32: 'N/NE',
        33: 'N/NE',
        34: 'N/NE',
        35: 'N/NE',
        36: 'N/NE',
        37: 'N/NE',
        38: 'N/NE',
        39: 'N/NE',
        40: 'NE',
        41: 'NE',
        42: 'NE',
        43: 'NE',
        44: 'NE',
        45: 'NE',
        46: 'NE',
        47: 'NE',
        48: 'NE',
        49: 'NE',
        50: 'NE',
        51: 'NE',
        52: 'NE',
        53: 'NE',
        54: 'NE',
        55: 'NE',
        56: 'NE',
        57: 'NE',
        58: 'NE',
        59: 'NE',
        60: 'E/NE',
        61: 'E/NE',
        62: 'E/NE',
        63: 'E/NE',
        64: 'E/NE',
        65: 'E/NE',
        66: 'E/NE',
        67: 'E/NE',
        68: 'E/NE',
        69: 'E/NE',
        70: 'E/NE',
        71: 'E/NE',
        72: 'E/NE',
        73: 'E/NE',
        74: 'E/NE',
        75: 'E/NE',
        76: 'E/NE',
        77: 'E/NE',
        78: 'E/NE',
        79: 'E/NE',
        80: 'E',
        81: 'E',
        82: 'E',
        83: 'E',
        84: 'E',
        85: 'E',
        86: 'E',
        87: 'E',
        88: 'E',
        89: 'E',
        90: 'E',
        91: 'E',
        92: 'E',
        93: 'E',
        94: 'E',
        95: 'E',
        96: 'E',
        97: 'E',
        98: 'E',
        99: 'E',
        100: 'E',
        101: 'E',
        102: 'E',
        103: 'E',
        104: 'E',
        105: 'E',
        106: 'E',
        107: 'E',
        108: 'E',
        109: 'E',
        110: 'E/SE',
        111: 'E/SE',
        112: 'E/SE',
        113: 'E/SE',
        114: 'E/SE',
        115: 'E/SE',
        116: 'E/SE',
        117: 'E/SE',
        118: 'E/SE',
        119: 'E/SE',
        120: 'E/SE',
        121: 'E/SE',
        122: 'E/SE',
        123: 'E/SE',
        124: 'E/SE',
        125: 'E/SE',
        126: 'E/SE',
        127: 'E/SE',
        128: 'E/SE',
        129: 'E/SE',
        130: 'SE',
        131: 'SE',
        132: 'SE',
        133: 'SE',
        134: 'SE',
        135: 'SE',
        136: 'SE',
        137: 'SE',
        138: 'SE',
        139: 'SE',
        140: 'SE',
        141: 'SE',
        142: 'SE',
        143: 'SE',
        144: 'SE',
        145: 'SE',
        146: 'SE',
        147: 'SE',
        148: 'SE',
        149: 'SE',
        150: 'S/SE',
        151: 'S/SE',
        152: 'S/SE',
        153: 'S/SE',
        154: 'S/SE',
        155: 'S/SE',
        156: 'S/SE',
        157: 'S/SE',
        158: 'S/SE',
        159: 'S/SE',
        160: 'S/SE',
        170: 'S',
        171: 'S',
        172: 'S',
        173: 'S',
        174: 'S',
        175: 'S',
        176: 'S',
        177: 'S',
        178: 'S',
        179: 'S',
        180: 'S',
        181: 'S',
        182: 'S',
        183: 'S',
        184: 'S',
        185: 'S',
        186: 'S',
        187: 'S',
        188: 'S',
        189: 'S',
        190: 'S',
        191: 'S',
        192: 'S',
        193: 'S',
        194: 'S',
        195: 'S',
        196: 'S',
        197: 'S',
        198: 'S',
        199: 'S',
        200: 'S/SW',
        201: 'S/SW',
        202: 'S/SW',
        203: 'S/SW',
        204: 'S/SW',
        205: 'S/SW',
        206: 'S/SW',
        207: 'S/SW',
        208: 'S/SW',
        209: 'S/SW',
        210: 'S/SW',
        211: 'S/SW',
        212: 'S/SW',
        213: 'S/SW',
        214: 'S/SW',
        215: 'S/SW',
        216: 'S/SW',
        217: 'S/SW',
        218: 'S/SW',
        219: 'S/SW',
        220: 'SW',
        221: 'SW',
        222: 'SW',
        223: 'SW',
        224: 'SW',
        225: 'SW',
        226: 'SW',
        227: 'SW',
        228: 'SW',
        229: 'SW',
        230: 'SW',
        231: 'SW',
        232: 'SW',
        233: 'SW',
        234: 'SW',
        235: 'SW',
        236: 'SW',
        237: 'SW',
        238: 'SW',
        239: 'SW',
        240: 'W/SW',
        241: 'W/SW',
        242: 'W/SW',
        243: 'W/SW',
        244: 'W/SW',
        245: 'W/SW',
        246: 'W/SW',
        247: 'W/SW',
        248: 'W/SW',
        249: 'W/SW',
        250: 'W/SW',
        251: 'W/SW',
        252: 'W/SW',
        253: 'W/SW',
        254: 'W/SW',
        255: 'W/SW',
        256: 'W/SW',
        257: 'W/SW',
        258: 'W/SW',
        259: 'W/SW',
        260: 'W',
        261: 'W',
        262: 'W',
        263: 'W',
        264: 'W',
        265: 'W',
        266: 'W',
        267: 'W',
        268: 'W',
        269: 'W',
        270: 'W',
        271: 'W',
        272: 'W',
        273: 'W',
        274: 'W',
        275: 'W',
        276: 'W',
        277: 'W',
        278: 'W',
        279: 'W',
        280: 'W',
        290: 'W/NW',
        300: 'W/NW',
        310: 'NW',
        320: 'NW',
        330: 'N/NW',
        340: 'N/NW'
    }

    city = string.capwords(city)
    state = string.capwords(state)

    url = f"http://api.airvisual.com/v2/city?city={city}&state={state}&country=USA&key={api}"
    response = requests.get(url)
    resp = response.json()

    wind_direction = wind_direction_dict[resp.get('data', {}).get('current', {}).get('weather', {}).get('wd')]
    print(wind_direction)

    results = {
        'city': resp.get('data', {}).get('city'),
        'state': resp.get('data', {}).get('state'),
        'country': resp.get('data', {}).get('country'),
        'location': resp.get('data', {}).get('location'),
        'current': {
            'pollution': resp.get('data', {}).get('current', {}).get('pollution'),
            'weather': resp.get('data', {}).get('current', {}).get('weather')
        },
        'full_resp': resp,
        'wind_direction': wind_direction
    }

    return results
